## Информация, полезная при работе над проектом ###

### Что делать, если тест падает?
1. Автотестировщики должны мониторить состояние тестовых запусков.
2. Если мы видим, что какой-то этап пайплайна упал, то надо выяснить причину.
3. Далее, есть варианты:
   - Тест упал, потому что что-то не работает в функционале продукта - тогда необходимо \
   сообщить разработчикам и завести баг.
   - Тест упал, потому что что-то не работает в самом тесте - необходимо завести задачу, \
   назначить того, за кем закреплена данная область (https://confluence.mts.ru/pages/viewpage.action?pageId=1006666998)
   - Тест упал, потому что что-то работает не так в Гитлабе - необходимо обратиться к девопсу и совместно разобраться.
4. Если починка предположительно займёт продолжительное время, больше четырёх часов, то надо этому тесту повесить флаг \
'*skip'* и в скобках указать номер задачи. Например: `"MDP-9999: Обновить импорты для health check admin office"`

### Правила создания TODO
1. Первое правило ~Бойцовского клуба~ поменьше создавать TODO. 
2. Не забывать про те TODO, которые были созданы ранее. Нужно проводить их ревью перед очередным планированием спринта.
3. Если всё же необходимо создать TODO, \
то должно это выглядеть так: `#TODO: Переписать метод создания записи в справочнике (MDP-9999)`
4. Если в тесте уже есть флаг `skip`, то создавать TODO для этих целей (что-то исправить) - не нужно.

### Правила оформления для названий коммитов и веток
Для того чтобы в будущем было более понятно, какие ветки для чего создавались, необходимо их группировать.\
Таким образом, сейчас можно использовать три группы: **feature**, **fix**, **draft**
- **feature** - для создания новых тестов, вспомогательных методов и т.д
- **bugfix** - для исправления некорректной работы тестов
- **draft** - для экспериментов
- **refactor** - для улучшений в коде

#### Про ветки
В итоге название ветки должно выглядеть так: *<имя группы>/<номер задачи в джире>-краткое-описание-задачи* \
Наглядный пример: `bugfix/MDP-2342-api-test-dictionaries-doesnt-word` или \
`draft/MDP-3453-research-how-to-create-tests-in-assembler`

#### Про создание новых веток
Ветки, как правило, надо создавать из мастера. Только если у вас в работе не две смежных задачи, которые имеют общие \
методы и, соответственно, зависят друг от друга. То есть, у них есть чёткая логическая связь.
Поэтому, если задача новая, то процесс выглядит следующим образом: \
1. `git checkout master`
2. `git pull`
3. `git checkout -b feature/MDP-9998-some-new-branch-name` (создалась новая ветка с последними изменениями из мастера)

Если написана часть кода в ветке, которая ещё не в мастере, и эта часть может быть использована в соседней ветке, то:
1. `git checkout feature/MDP-9998-some-new-branch-name`
2. `git checkout -b feature/MDP-9999-some-another-new-branch-name` (понятно, 
что в таком случае коммиты из `MDP-9998` попадут в `MDP-9999`. Желательно об этом написать в создаваемом **MR**)

Если надо забрать изменения из мастера в процессе работы над своей веткой, то:
1. Сначала коммитим свои изменения в текущей ветке, во избежание всяческих недоразумений
2. Затем, `git checkout master`
3. `git pull`
4. `git checkout feature/MDP-9998-some-new-branch-name`
5. `git merge master` (Внимательно проверяем конфликты, чтобы не затереть то, что к нашей задаче не имеет отношения)

#### Про коммиты
Коммиты желательно делать не очень большими, особенно если задача большая. Разделять по логически завершённым шагам.
Бывает, что в рамках задачи необходимо поправить много мелочей в нескольких файлах, одновременно с написанием нового кода.
Тогда, лучше мелкие фиксы в один коммит, а новый функционал в другой. \
Пример именования коммита: `git commit -m "MDP-6343: Added correct order for imports"`

#### Заметки по нумерации фиксов, которые касаются только нашего репозитория ####
Если нужно сделать быстрофикс, который никак не относится к какой-то задаче, то можно просто создать ветку, присвоить
ей номер 42 и дать удобное название, чтобы было понятно, для чего она вообще нужна.

#### Про добавление изменений в мастер (merge-requests)
- Изменения в мастер сливает тот человек, который создал ветку по задаче и закончил над ней работу. В качестве
исключения можно принять ситуацию, когда разработчик в отпуске или заболел, тогда его коллега может это сделать.
- При анализе кода другими разработчиками создаются треды из комментариев, где пишутся замечания по коду. Эти треды может
закрыть тот, кто их собственно создал, а не автор ветки. Задача автора ветки - внести изменения в соответствии с замечанием
или аргументировано оспорить и не делать изменений. Тогда авто комментария также закрывает тред.
- Один мёрдж-реквест подразумевает работу над одной задачей. Нельзя создать мёрдж-реквест на создание теста по какому-то
новому функционалу и добавить туда, между делом, ещё изменения по структуре папок, переименование некоторых файлов и ещё
щепотку рефакторинга.

#### Как правильно писать тесты, чтобы работала интеграция с Allure
Создавая новый тест, необходимо при задании нового метода указывать параметры, которые позволят в дальнейшем связать
авто-тесты и тесты в Аллюре, а также позволят Аллюру корректно отображать результаты запущенных тестов.  

Какие параметры обязательны:

- **@allure.title("<Заголовок теста>")**   
_Например: "Отредактировать страт-план"_  


- **@allure.description("<Описание, что за тест>")**  
Например: _"Смоук тест для создания страт плана. Проверяет обязательные поля, а также функцию редактирования"_  


- **@allure.story('https://jira.mts.ru/browse/MDP-1658')**  
_В дальнейшем будет фикстура, которая позволит 
избавиться от прямых ссылок и будет вид, типа: **MDP-1658**_


- **@allure.issue('https://jira.mts.ru/browse/MDP-2568')**  
_Ссылка на баг, по которому написан тест-кейс_  


- **@allure.severity(allure.severity_level.NORMAL)**  
_Уровень приоритетности теста. В Allure есть четыре уровня: **Minor**, **Normal**, **Critical**, **Blocker**.
По умолчанию **Normal**_


- @allure.testcase('https://allure.services.mts.ru/project/130/test-cases/275830')  
_В дальнейшем будет фикстура, которая позволит избавиться от прямых ссылок и будет вид, типа **#275830**_

### Правила написания Docstrings
Docstrings описывается сразу после опеределения функций, методов, классов и модулей.
Мы используем  Google Style Python Docstrings. https://google.github.io/styleguide/pyguide.html
Примеры:
```python
def hello_word() -> None:
    """Однострочная документация (краткое описание)"""
    print("Hello word")

def add(a: int, b: int) -> int:
    """Эта функция содержит многострочную документацию.
        
        В многострочной документации первое предложение - это краткое описание. 
    Args:
        Далее блок описания параметров, если они есть
        a: Первый параметр
        b: Второй Параметр
    Returns:
        Описание, того что возвращает функция. 
        Блок является не обязательным, если функция или метод ничего не вовращает
    Raises:
        Вызываемое исключание, если есть
    """
    return a + b
```
### Правила оформления типизации параметров функций
При создании метода или функции необходимо указать тип всех параметров и тип возвращаемого значения.
Если метод ничего не возвращает, то тип None.
Примеры:
```python
def add(a: int, b: int) -> int:
    return a + b 

def hello_word() -> None:
    print("Hello word")
```

### Общие правила написания кода
1. Избегать использования хардкода везде, кроме мест, где без хардкода на данный момент обойтись невозможно. Если же \
это произошло, то лучше оставить TODO, как напоминание, чтобы можно было вернуться позже и убрать хардкод.
2. Весь хардкод выносить в файл **constants**
3. Имена переменных должны нести в себе достаточно информации для понимания об их роли. Переменные вида `hrdсd` 
лучше избегать
#### Использование кавычек
Согласно **PEP008**:
> In Python, single-quoted strings and double-quoted strings are the same. \
> This PEP does not make a recommendation for this. 
> Pick a rule and stick to it. When a string contains single or double quote characters, \
> however, use the other one to avoid backslashes in the string. It improves readability. \

Поэтому, логичнее будет использовать следующий подход: `"Hello world! This is 'sting'"`. То есть сначала двойные \
кавычки, потом одинарные. То же касается и graphql-контрактов. \
Правильно:
```json
"mutation PlacementPubSave($id: ID!, $data: PlacementPubData!) {placementPubSave(id: $id, data: $data)"
```

Неправильно:
```
"""mutation PlacementPubSave($id: ID!, $data: PlacementPubData!) {placementPubSave(id: $id, data: $data)"""
```

### Переменные окружения
Для получения локальных переменных обратиться к Зайцеву Евгению, Яровому Степану или Галкину Александру
